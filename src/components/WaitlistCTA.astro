---
const success = Astro.url.searchParams.get("success") === "1";
---
<section class="bg-dark border-b border-grid" id="waitlist">
  <div class="p-8 lg:p-16 max-w-2xl mx-auto">

    <!-- Header -->
    <div class="mb-12">
      <h2 class="font-mono text-xs uppercase text-gray-500 mb-4">Early Access</h2>
      <h3 class="text-4xl lg:text-5xl font-semibold uppercase mb-[32px] whitespace-nowrap">
        Be first to try tomoro
      </h3>
    </div>

    {
      success ? (
        <div class="text-center mt-6">
          <p class="text-lg text-accent font-semibold mb-2">âœ“ You're on the list!</p>
          <p class="text-sm text-gray-400">Check your email for updates. We'll be in touch soon.</p>
        </div>
      ) : (
        <>
          <p class="text-base lg:text-lg text-gray-400 mb-12 leading-relaxed">
            Tomoro is a clean, offline workspace for solo professionals who want
            clarity instead of clutter. Join the waitlist to get early builds,
            updates, and a launch discount.
          </p>

          <!-- Native Vercel Forms integration -->
          <form
            method="POST"
            action="/"
            data-vercel-form="tomoro-waitlist"
            class="mb-6 flex gap-3"
          >
            <input
              type="email"
              name="email"
              placeholder="your email"
              class="flex-1 bg-dark border border-light text-light px-4 py-3 rounded font-mono text-sm placeholder-gray-600 focus:outline-none focus:ring-2 focus:ring-accent"
              required
            />

            <!-- required for Vercel -->
            <input type="hidden" name="_vercel_form" value="tomoro-waitlist" />

            <!-- redirect after success -->
            <input type="hidden" name="_redirect" value="/?success=1#waitlist" />

            <button
              type="submit"
              class="font-mono font-bold text-sm px-8 py-3 border border-light text-light rounded hover:bg-light hover:text-dark transition-all duration-200 whitespace-nowrap"
            >
              Join Waitlist
            </button>
          </form>

          <p class="text-xs text-gray-500 text-center">
            No spam. No marketing noise. Just product updates.
          </p>
        </>
      )
    }
  </div>
</section>

<script>
  (function () {
    try {
      var params = new URLSearchParams(window.location.search);
      var success = params.get("success") === "1";

      var form = document.getElementById("waitlist-form");
      var successBox = document.getElementById("success-message");

      if (success) {
        const form = document.querySelector("form[data-vercel-form]");
        const successMsg = document.getElementById("success-message");

        if (form && successMsg) {
          form.style.display = "none";
          successMsg.style.display = "block";
        }

        // remove query params but keep anchor
        window.history.replaceState({}, "", "/#waitlist");
      }
    } catch (e) {
      console.error("Error handling waitlist success:", e);
    }
  })();
</script>
