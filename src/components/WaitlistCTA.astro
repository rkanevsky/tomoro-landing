---
import { createClient } from "@supabase/supabase-js";

const supabaseUrl = import.meta.env.PUBLIC_SUPABASE_URL;
const supabaseKey = import.meta.env.PUBLIC_SUPABASE_ANON_KEY;

const supabase = createClient(supabaseUrl, supabaseKey);
---

<section class="bg-dark border-b border-grid" id="waitlist">
    <div class="p-8 lg:p-16 max-w-2xl mx-auto">
        <!-- Header -->
        <div class="mb-12">
            <h2 class="font-mono text-xs uppercase text-gray-500 mb-4">
                Early Access
            </h2>
            <h3
                class="text-4xl lg:text-5xl font-semibold uppercase mb-[32px] whitespace-nowrap"
            >
                Be first to try tomoro
            </h3>
        </div>

        <!-- Success -->
        <div
            id="waitlist-success"
            style="display:none"
            class="text-center mt-6"
        >
            <p class="text-lg text-accent font-semibold mb-2">
                âœ“ You're on the list!
            </p>
            <p class="text-sm text-gray-400">
                Check your email for updates. We'll be in touch soon.
            </p>
        </div>

        <!-- Form -->
        <form
            id="waitlist-form"
            class="mb-6 flex gap-3"
            data-supabase-url={supabaseUrl}
            data-supabase-key={supabaseKey}
        >
            <input
                type="email"
                id="waitlist-email"
                placeholder="your email"
                class="flex-1 bg-dark border border-light text-light px-4 py-3 rounded font-mono text-sm placeholder-gray-600 focus:outline-none focus:ring-2 focus:ring-accent"
                required
            />
            <button
                type="submit"
                class="font-mono font-bold text-sm px-8 py-3 border border-light text-light rounded hover:bg-light hover:text-dark transition-all duration-200 whitespace-nowrap"
            >
                Join Waitlist
            </button>
        </form>

        <p class="text-xs text-gray-500 text-center">
            No spam. No marketing noise. Just product updates.
        </p>
    </div>
</section>

<script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    const form = document.getElementById("waitlist-form");
    const emailInput = document.getElementById("waitlist-email");
    const successBox = document.getElementById("waitlist-success");
    const submitBtn = form.querySelector("button");

    const url = form.dataset.supabaseUrl;
    const key = form.dataset.supabaseKey;
    const supabase = createClient(url, key);

    form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const email = emailInput.value.trim();
        if (!email) return;

        submitBtn.disabled = true;
        submitBtn.textContent = "Joining...";

        const { error } = await supabase.from("waitlist").insert([{ email }]);

        if (error) {
            console.error(error);
            alert("Something went wrong. Please try again.");
            submitBtn.disabled = false;
            submitBtn.textContent = "Join Waitlist";
            return;
        }

        form.style.display = "none";
        successBox.style.display = "block";
    });
</script>
